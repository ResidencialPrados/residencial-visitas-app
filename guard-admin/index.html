<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Guardia Administrador</title>

  <!-- Theme global -->
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/styles-guard-admin.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js" defer></script>

  <!-- QR Scanner -->
  <script src="https://unpkg.com/html5-qrcode" defer></script>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 class="title">Dashboard Guardia Administrador</h1>
      <nav class="nav-buttons">
        <button id="logoutBtn" class="btn">Cerrar sesión</button>
        <button id="activarQRBtn" class="btn">Activar Lector QR</button>
        <button id="pagosBtn" class="btn">Pagos</button>
        <button id="toggleHistorialBtn" class="btn">Ver Historial Completo</button>
      </nav>
    </header>

    <main>
      <!-- Scanner QR -->
      <section id="qr-reader" class="qr-section" aria-hidden="true"></section>

      <!-- Visitas Pendientes -->
      <section class="card">
        <h2>Visitas Pendientes (últimas 24 h)</h2>
        <table class="table">
          <thead>
            <tr>
              <th>Nombre Visitante</th><th>Marca</th><th>Color</th>
              <th>Placa</th><th>Casa</th><th>Bloque</th>
              <th>Teléfono</th><th>Guardia</th><th>Hora</th><th>Acción</th>
            </tr>
          </thead>
          <tbody id="visitas-body">
            <tr><td colspan="10" class="loading">Cargando…</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Registro de Usuario -->
      <section class="card">
        <h2>Registro de Usuario</h2>
        <form id="crearUsuarioForm" class="form-stack" autocomplete="off">
          <div class="field">
            <label for="rolUsuario">Rol:</label>
            <select id="rolUsuario" required>
              <option value="">Seleccione rol</option>
              <option value="guard">Guardia Común</option>
              <option value="guard_admin">Guardia Administrador</option>
              <option value="resident">Residente</option>
            </select>
          </div>
          <div id="camposExtra" class="form-stack" style="display:none">
            <!-- aquí van email, contraseña, nombre, identidad, etc. -->
          </div>
          <button type="submit" class="btn-full">Crear Usuario</button>
          <p id="crearUsuarioMsg" class="message"></p>
        </form>
      </section>

      <!-- Residentes y Pagos -->
      <section class="card">
        <h2>Residentes y Pagos</h2>
        <div class="field">
          <input type="text" id="buscarResidente" placeholder="Buscar por nombre, correo, casa, bloque o teléfono">
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Nombre</th><th>Correo</th><th>Teléfono</th>
              <th>Casa</th><th>Bloque</th><th>Pago</th>
            </tr>
          </thead>
          <tbody id="residents-body">
            <tr><td colspan="6" class="loading">Cargando…</td></tr>
          </tbody>
        </table>
      </section>
    </main>

    <footer class="footer">
      <button class="back-btn btn" onclick="history.back()">← Volver</button>
    </footer>
  </div>

  <!-- Scripts -->
  <script src="js/main-guard-admin.js" defer></script>
  <script>
    // Registrar SW en guard-admin/js/service-worker.js
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('js/service-worker.js', { scope: './' })
        .then(() => console.log('SW registrado'))
        .catch(err => console.error('Error al registrar SW:', err));
    }
  </script>
</body>
</html>
